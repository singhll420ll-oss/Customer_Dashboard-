// Global utility functions
document.addEventListener('DOMContentLoaded',function(){
    // Auto-hide alerts after 5 seconds
    setTimeout(()=>{
        document.querySelectorAll('.alert').forEach(alert=>{
            new bootstrap.Alert(alert).close()
        })
    },5000)
    
    // Form validation
    const forms=document.querySelectorAll('.needs-validation')
    Array.from(forms).forEach(form=>{
        form.addEventListener('submit',event=>{
            if(!form.checkValidity()){
                event.preventDefault()
                event.stopPropagation()
            }
            form.classList.add('was-validated')
        },false)
    })
    
    // Initialize tooltips
    const tooltipTriggerList=[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    tooltipTriggerList.map(tooltipTriggerEl=>new bootstrap.Tooltip(tooltipTriggerEl))
})

// Toast notification
function showToast(message,type='success'){
    const toast=document.createElement('div')
    toast.className=`toast align-items-center text-bg-${type} border-0`
    toast.setAttribute('role','alert')
    toast.innerHTML=`
        <div class="d-flex">
            <div class="toast-body">${message}</div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
    `
    document.body.appendChild(toast)
    const bsToast=new bootstrap.Toast(toast,{delay:3000})
    bsToast.show()
    toast.addEventListener('hidden.bs.toast',()=>toast.remove())
}

// Location utility
function getCurrentLocation(){
    return new Promise((resolve,reject)=>{
        if(!navigator.geolocation){
            reject('Geolocation not supported')
            return
        }
        navigator.geolocation.getCurrentPosition(
            position=>resolve({
                lat:position.coords.latitude,
                lng:position.coords.longitude
            }),
            error=>reject(error.message)
        )
    })
}

// Format currency
function formatCurrency(amount){
    return new Intl.NumberFormat('en-IN',{
        style:'currency',
        currency:'INR',
        minimumFractionDigits:2
    }).format(amount)
}

// Debounce function for search
function debounce(func,wait){
    let timeout
    return function executedFunction(...args){
        const later=()=>{
            clearTimeout(timeout)
            func(...args)
        }
        clearTimeout(timeout)
        timeout=setTimeout(later,wait)
    }
}

// Mobile menu toggle for responsive
function setupMobileMenu(){
    const menuToggle=document.querySelector('[data-bs-toggle="collapse"]')
    if(menuToggle){
        menuToggle.addEventListener('click',function(){
            const target=document.querySelector(this.getAttribute('data-bs-target'))
            target.classList.toggle('show')
        })
    }
}

// Initialize on page load
setupMobileMenu()
